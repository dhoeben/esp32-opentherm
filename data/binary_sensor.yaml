binary_sensor:
  - platform: template
    name: "Tap Water Flow Detected"
    id: tap_flow
    device_id: dhw
    device_class: running
    entity_category: diagnostic
    lambda: |-
      auto ot = opentherm::OpenThermComponent::get_singleton();
      return ot ? ot->tap_flow() : false;

  - platform: template
    id: ch_active
    name: "CH Active"
    device_id: ch
    icon: mdi:radiator
    entity_category: diagnostic

  - platform: template
    id: dhw_active
    name: "DHW Active"
    device_id: dhw
    icon: mdi:water-boiler
    entity_category: diagnostic

  - platform: template
    name: "DHW Heating Active"
    device_id: dhw
    id: dhw_heating_active
    device_class: heat
    lambda: |-
      auto ot = opentherm::OpenThermComponent::get_singleton();
      if (ot == nullptr) return false;
      return ot->tap_flow();  // true if DHW tap/flow is active
    entity_category: diagnostic

  - platform: template
    name: "DHW Preheat Active"
    device_id: dhw
    id: dhw_preheat_active
    icon: "mdi:water-boiler"
    lambda: |-
      return opentherm::DHW::comfort_mode_enabled;
    entity_category: diagnostic

  - platform: template
    id: boiler_flame
    name: "Boiler Flame"
    icon: mdi:fire
    entity_category: diagnostic

  - platform: template
    id: boiler_fault
    name: "Boiler Fault"
    entity_category: diagnostic
    icon: mdi:alert-box
    device_class: problem

  - platform: template
    id: boiler_diag
    name: "Boiler Diagnostic"
    icon: mdi:information
    entity_category: diagnostic

  - platform: template
    id: comms_ok
    name: "OpenTherm Communication"
    entity_category: diagnostic
    device_class: connectivity

  - platform: template
    id: dhw_flowing
    device_id: dhw
    name: "DHW Water Flowing"
    device_class: running
    entity_category: diagnostic
